#!/usr/bin/env ruby

require 'json'
require 'httparty'
require 'pp'

# ElasticSearch location
host  = 'localhost'
port  = '9200'

# Index and document type name
index = 'elasticsearch-by-example'
type  = 'example'

base  = "http://#{host}:#{port}"

# Path to example depending on console parameter
path  = "examples/#{ARGV[0]}"

# Remove index. A new index will be created while indexing documents.
HTTParty.delete("#{base}/#{index}")

# Index documents
docs = JSON.parse(File.read("#{path}/docs.json"))
docs.each_with_index do |doc, i|
  HTTParty.put("#{base}/#{index}/#{type}/#{i}", {:body => doc.to_json})
end

# Refresh index
HTTParty.post("#{base}/#{index}/_refresh")

# Query index
query = File.read("#{path}/query.json")
response = HTTParty.post("#{base}/#{index}/#{type}/_search", {:body => query})
puts "Result\n"
puts "------"
pp response.parsed_response
